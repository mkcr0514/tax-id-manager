<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÂÖ¨Âè∏Êä¨È†≠ÂèäÁµ±Á∑®Êü•Ë©¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            background: #0a0a0a;
        }
        .glass-card {
            background: rgba(30, 30, 30, 0.8);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .glass-button {
            background: rgba(50, 50, 50, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .glass-button:hover {
            background: rgba(70, 70, 70, 0.8);
        }
        .glass-button:active {
            background: rgba(90, 90, 90, 1);
        }
        .primary-button {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        .primary-button:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        }
        .primary-button:active {
            background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
        }
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.7);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icons
        const Search = ({ className = "w-5 h-5" }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
        );

        const History = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const Plus = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
            </svg>
        );

        const Edit2 = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
        );

        const Trash2 = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
        );

        const Save = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
            </svg>
        );

        const X = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
            </svg>
        );

        const Download = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
        );

        const Upload = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
            </svg>
        );

        const RefreshCw = () => (
            <svg className="w-5 h-5 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
        );

        const Delete = () => (
            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2M3 12l6.414 6.414a2 2 0 001.414.586H19a2 2 0 002-2V7a2 2 0 00-2-2h-8.172a2 2 0 00-1.414.586L3 12z" />
            </svg>
        );
        
        const ClearAll = () => (
             <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" />
             </svg>
        );

        const ArrowUp = () => (
             <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 10l7-7m0 0l7 7m-7-7v18" />
             </svg>
        );

        // Modal Component
        function TaxIdModal({ content, onClose }) {
            if (!content) return null;

            return (
                <div 
                    className="fixed inset-0 z-50 flex items-center justify-center modal-overlay"
                    onClick={onClose}
                >
                    <div 
                        className="glass-card rounded-3xl p-6 m-4 max-w-sm w-full relative"
                        onClick={(e) => e.stopPropagation()} // Èò≤Ê≠¢ÈªûÊìä Modal ÂÖßÂÆπÊôÇÈóúÈñâ
                    >
                        <h2 className="text-xl font-bold mb-4 border-b border-gray-700 pb-3">ÂÖ¨Âè∏Ë≥áË®ä</h2>
                        <div className="space-y-4">
                            <div>
                                <p className="text-gray-400 text-sm mb-1">ÂÖ¨Âè∏Êä¨È†≠</p>
                                <p className="text-2xl font-bold break-words">{content.companyName}</p>
                            </div>
                            <div>
                                <p className="text-gray-400 text-sm mb-1">Áµ±‰∏ÄÁ∑®Ëôü</p>
                                <p className="text-3xl font-extrabold text-blue-400">{content.taxId}</p>
                            </div>
                            {content.note && (
                                <div>
                                    <p className="text-gray-400 text-sm mb-1">ÂÇôË®ª</p>
                                    <p className="text-base text-gray-300 whitespace-pre-wrap">{content.note}</p>
                                </div>
                            )}
                        </div>
                        <button
                            onClick={onClose}
                            className="w-full mt-6 py-3 primary-button text-white rounded-xl font-semibold"
                        >
                            ÈóúÈñâ
                        </button>
                        <button
                            onClick={onClose}
                            className="absolute top-4 right-4 text-gray-400 hover:text-white"
                        >
                            <X />
                        </button>
                    </div>
                </div>
            );
        }

        function TaxIdManager() {
            const [activeTab, setActiveTab] = useState('search');
            const [records, setRecords] = useState([]);
            const [searchTaxId, setSearchTaxId] = useState('');
            const [displayTaxId, setDisplayTaxId] = useState(''); // Áî®ÊñºÈ°ØÁ§∫Êü•Ë©¢ÁµêÊûúÊôÇÁöÑÁµ±Á∑®
            const [searchResult, setSearchResult] = useState(null);
            const [isSearching, setIsSearching] = useState(false);
            const [isAdding, setIsAdding] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [newRecord, setNewRecord] = useState({ taxId: '', companyName: '', note: '' });
            const [loading, setLoading] = useState(true);
            const [editForm, setEditForm] = useState({});
            const [historySearchText, setHistorySearchText] = useState('');
            const [modalContent, setModalContent] = useState(null); // Modal ÂÖßÂÆπ { taxId, companyName, note }
            const [showBackToTop, setShowBackToTop] = useState(false);

            useEffect(() => {
                loadRecords();
            }, []);
            
            useEffect(() => {
                const handleScroll = () => {
                    if (activeTab === 'history') {
                        if (window.scrollY > 300) { 
                            setShowBackToTop(true);
                        } else {
                            setShowBackToTop(false);
                        }
                    } else {
                        setShowBackToTop(false);
                    }
                };

                window.addEventListener('scroll', handleScroll);
                return () => window.removeEventListener('scroll', handleScroll);
            }, [activeTab]); 

            const scrollToTop = () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const loadRecords = () => {
                try {
                    const data = localStorage.getItem('taxIdRecords');
                    if (data) {
                        const parsed = JSON.parse(data);
                        setRecords(parsed.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)));
                    }
                } catch (error) {
                    console.error('ËºâÂÖ•Â§±Êïó:', error);
                    setRecords([]);
                } finally {
                    setLoading(false);
                }
            };

            const saveRecords = (newRecords) => {
                try {
                    localStorage.setItem('taxIdRecords', JSON.stringify(newRecords));
                    setRecords(newRecords.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)));
                    return true;
                } catch (error) {
                    console.error('ÂÑ≤Â≠òÂ§±Êïó:', error);
                    alert('ÂÑ≤Â≠òÂ§±Êïó');
                    return false;
                }
            };

            const deleteRecord = (taxId) => {
                if (!confirm('Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÁ≠ÜË®òÈåÑÂóéÔºü')) return;
                const newRecords = records.filter(r => r.taxId !== taxId);
                saveRecords(newRecords);
            };

            const queryG0vAPI = async (taxId) => {
                try {
                    const apiUrl = `https://company.g0v.ronny.tw/api/show/${taxId}`;
                    const response = await fetch(apiUrl);
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    const data = await response.json();
                    return data;
                } catch (error) {
                    console.error('API Êü•Ë©¢ÈåØË™§:', error);
                    alert(`Êü•Ë©¢Â§±ÊïóÔºö${error.message}`);
                    return null;
                }
            };

            const handleSearch = async () => {
                const taxId = searchTaxId.trim();
                if (!taxId) {
                    alert('Ë´ãËº∏ÂÖ•Áµ±‰∏ÄÁ∑®Ëôü');
                    return;
                }
                
                setIsSearching(true);
                setSearchResult(null);
                
                const localRecord = records.find(r => r.taxId === taxId);
                
                if (localRecord) {
                    setSearchResult({ ...localRecord, source: 'local' });
                    setDisplayTaxId(taxId); 
                    setSearchTaxId(''); 
                    setIsSearching(false);
                } else {
                    const apiData = await queryG0vAPI(taxId);
                    setIsSearching(false);
                    
                    if (apiData && apiData.data) {
                        const companyName = apiData.data.ÂÖ¨Âè∏ÂêçÁ®± || apiData.data.ÂïÜÊ•≠ÂêçÁ®±;
                        if (companyName) {
                            setSearchResult({
                                taxId: taxId,
                                companyName: companyName,
                                address: apiData.data.ÂÖ¨Âè∏ÊâÄÂú®Âú∞ || apiData.data.ÂïÜÊ•≠ÊâÄÂú®Âú∞ || '',
                                status: apiData.data.ÂÖ¨Âè∏ÁãÄÊ≥Å || apiData.data.ÂïÜÊ•≠ÁãÄÊ≥Å || '',
                                capital: apiData.data.Ë≥áÊú¨Á∏ΩÈ°ç || apiData.data.Ë≥áÊú¨È°ç || '',
                                source: 'api'
                            });
                            setDisplayTaxId(taxId); 
                            setSearchTaxId(''); 
                        } else {
                            alert('Êü•ÁÑ°Ê≠§Áµ±Á∑®Ë≥áÊñô');
                        }
                    } else {
                        alert('Êü•ÁÑ°Ê≠§Áµ±Á∑®Ë≥áÊñô');
                    }
                }
            };

            // Ê∏ÖÈô§ÂÖ®ÈÉ®ÂÖßÂÆπÁöÑÂáΩÂºè
            const handleClearAll = () => {
                setSearchTaxId('');
                setDisplayTaxId('');
                setSearchResult(null);
            };

            const handleSaveFromSearch = () => {
                if (!searchResult) return;
                const record = {
                    taxId: searchResult.taxId,
                    companyName: searchResult.companyName,
                    note: searchResult.note || '',
                    address: searchResult.address || '',
                    status: searchResult.status || '',
                    capital: searchResult.capital || '',
                    createdAt: new Date().toISOString()
                };
                
                const existingIndex = records.findIndex(r => r.taxId === record.taxId);
                let newRecords = existingIndex >= 0 
                    ? records.map((r, i) => i === existingIndex ? record : r)
                    : [...records, record];
                
                if (saveRecords(newRecords)) {
                    alert('Â∑≤ÂÑ≤Â≠òÂà∞Ë®òÈåÑ');
                    setSearchResult({ ...record, source: 'local' });
                    setDisplayTaxId('');
                    setSearchTaxId('');
                    setSearchResult(null);
                }
            };

            const handleAddRecord = () => {
                const taxId = newRecord.taxId.trim();
                const companyName = newRecord.companyName.trim();
                
                if (!taxId || !companyName) {
                    alert('Ë´ãÂ°´ÂØ´Áµ±‰∏ÄÁ∑®ËôüÂíåÂÖ¨Âè∏Êä¨È†≠');
                    return;
                }
                
                const record = {
                    taxId,
                    companyName,
                    note: newRecord.note.trim(),
                    createdAt: new Date().toISOString()
                };
                
                const existingIndex = records.findIndex(r => r.taxId === record.taxId);
                let newRecords = existingIndex >= 0
                    ? records.map((r, i) => i === existingIndex ? record : r)
                    : [...records, record];
                
                if (saveRecords(newRecords)) {
                    setNewRecord({ taxId: '', companyName: '', note: '' });
                    setIsAdding(false);
                }
            };

            const startEdit = (record) => {
                setEditingId(record.taxId);
                setEditForm({ ...record });
            };

            const cancelEdit = () => {
                setEditingId(null);
                setEditForm({});
            };

            const handleUpdateRecord = () => {
                if (!editForm.companyName.trim()) {
                    alert('ÂÖ¨Âè∏Êä¨È†≠‰∏çËÉΩÁÇ∫Á©∫');
                    return;
                }
                
                const newRecords = records.map(r => 
                    r.taxId === editForm.taxId ? editForm : r
                );
                
                if (saveRecords(newRecords)) {
                    setEditingId(null);
                    setEditForm({});
                }
            };

            const exportData = () => {
                const dataStr = JSON.stringify(records, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `Áµ±Á∑®Ë≥áÊñô_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
            };

            const importData = async (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                try {
                    const text = await file.text();
                    const importedRecords = JSON.parse(text);
                    
                    if (!Array.isArray(importedRecords)) {
                        alert('Ê™îÊ°àÊ†ºÂºèÈåØË™§');
                        return;
                    }
                    
                    const mergedRecords = [...records];
                    importedRecords.forEach(imported => {
                        if (imported.taxId && imported.companyName) {
                            const existingIndex = mergedRecords.findIndex(r => r.taxId === imported.taxId);
                            if (existingIndex >= 0) {
                                mergedRecords[existingIndex] = imported;
                            } else {
                                mergedRecords.push(imported);
                            }
                        }
                    });
                    
                    if (saveRecords(mergedRecords)) {
                        alert(`ÊàêÂäüÂåØÂÖ•/Êõ¥Êñ∞ ${importedRecords.length} Á≠ÜË≥áÊñô`);
                    }
                } catch (error) {
                    console.error('ÂåØÂÖ•ÈåØË™§:', error);
                    const userFriendlyError = "ÂåØÂÖ•Â§±Êïó„ÄÇË´ãÊ™¢Êü•Ê™îÊ°àÊòØÂê¶ÁÇ∫ JSON Ê†ºÂºèÔºå‰∏¶‰∏îÂÖßÂÆπÊòØÂåÖÂê´ 'taxId' Âíå 'companyName' Ê¨Ñ‰ΩçÁöÑË≥áÊñôÈô£Âàó„ÄÇ";
                    alert(userFriendlyError);
                }
                event.target.value = '';
            };

            const handleNumberClick = (num) => {
                // üåü ÈªûÊìäÈçµÁõ§ÊôÇÔºåËá™ÂãïÊç≤ÂãïÂà∞È†ÇÈÉ® (Tab‰ΩçÁΩÆ)
                scrollToTop();

                // Â¶ÇÊûúÊúâÊêúÂ∞ãÁµêÊûúÔºåÂÖàÊ∏ÖÁ©∫ÂÜçËº∏ÂÖ•
                if (searchResult) {
                    handleClearAll();
                    setSearchTaxId(num);
                } else if (searchTaxId.length < 8) {
                    setSearchTaxId(searchTaxId + num);
                }
            };

            const handleBackspace = () => {
                setSearchTaxId(searchTaxId.slice(0, -1));
            };

            const openModal = (taxId, companyName, note = '') => {
                setModalContent({ taxId, companyName, note });
            };

            const closeModal = () => {
                setModalContent(null);
            };

            const filteredRecords = records.filter(record => {
                const searchLower = historySearchText.toLowerCase();
                return record.taxId.includes(searchLower) || 
                       record.companyName.toLowerCase().includes(searchLower);
            });

            // Ê±∫ÂÆöËº∏ÂÖ•Ê°ÜÈ°ØÁ§∫ÁöÑÂÖßÂÆπ
            const inputDisplayValue = displayTaxId || searchTaxId;
            
            // Âà§Êñ∑Â∑¶‰∏ãËßíÊåâÈàïÁãÄÊÖã
            const isSearchResultPresent = !!searchResult;

            return (
                <div className="min-h-screen bg-black text-white">
                    <TaxIdModal content={modalContent} onClose={closeModal} />

                    {/* Header */}
                    <div className="p-6 pb-4">
                        <h1 className="text-2xl font-bold text-center">ÂÖ¨Âè∏Êä¨È†≠ÂèäÁµ±Á∑®Êü•Ë©¢</h1>
                    </div>

                    {/* Tabs */}
                    <div className="px-4 pt-2 pb-4">
                        <div className="glass-card rounded-full p-1 flex">
                            <button
                                onClick={() => setActiveTab('search')}
                                className={`flex-1 py-3 rounded-full font-medium transition-all flex items-center justify-center gap-2 ${
                                    activeTab === 'search'
                                        ? 'primary-button text-white'
                                        : 'text-gray-400'
                                }`}
                            >
                                <Search className="w-4 h-4" />
                                Êü•Ë©¢
                            </button>
                            <button
                                onClick={() => setActiveTab('history')}
                                className={`flex-1 py-3 rounded-full font-medium transition-all flex items-center justify-center gap-2 ${
                                    activeTab === 'history'
                                        ? 'primary-button text-white'
                                        : 'text-gray-400'
                                }`}
                            >
                                <History />
                                Ë®òÈåÑ ({records.length})
                            </button>
                        </div>
                    </div>

                    {/* Content */}
                    <div className="px-4 pb-32">
                        {/* Êü•Ë©¢È†ÅÁ±§ */}
                        {activeTab === 'search' && (
                            <div className="space-y-4">
                                {/* Ëº∏ÂÖ•È°ØÁ§∫ */}
                                <div className="glass-card rounded-3xl p-6">
                                    <label className="block text-gray-400 text-sm mb-3">Áµ±‰∏ÄÁ∑®Ëôü</label>
                                    <div className="relative">
                                        <input
                                            type="text"
                                            value={inputDisplayValue}
                                            readOnly
                                            placeholder="Ë´ã‰ΩøÁî®‰∏ãÊñπÊï∏Â≠óÈçµÁõ§Ëº∏ÂÖ•Áµ±‰∏ÄÁ∑®Ëôü"
                                            // üåü ÁßªÈô§ autoFocus Â±¨ÊÄß
                                            className="w-full px-6 py-5 text-3xl font-bold text-center bg-black/50 rounded-2xl border border-gray-700 focus:border-blue-500 outline-none placeholder:text-gray-600 placeholder:text-lg"
                                        />
                                        {inputDisplayValue && (
                                            <button
                                                // ÊîæÂ§ßÈªûÊìäÁØÑÂúç: p-2
                                                onClick={handleClearAll}
                                                className="absolute right-2 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white p-2"
                                            >
                                                <X />
                                            </button>
                                        )}
                                    </div>
                                </div>

                                {/* Êü•Ë©¢ÁµêÊûú */}
                                {searchResult && (
                                    <div 
                                        className="glass-card rounded-3xl p-6 cursor-pointer hover:bg-opacity-90 transition-all"
                                        onClick={() => openModal(searchResult.taxId, searchResult.companyName, searchResult.note)}
                                    >
                                        <div className="flex items-start justify-between mb-4">
                                            <div className="flex-1">
                                                <h3 className="text-xl font-bold mb-2">{searchResult.companyName}</h3>
                                                <p className="text-blue-400 mb-3">{searchResult.taxId}</p>
                                            </div>
                                            <span className={`px-3 py-1 text-xs rounded-full ${
                                                searchResult.source === 'local' 
                                                    ? 'bg-green-500/20 text-green-400 border border-green-500/30' 
                                                    : 'bg-yellow-500/20 text-yellow-400 border border-yellow-500/30'
                                            }`}>
                                                {searchResult.source === 'local' ? 'Ê≠∑Âè≤Á¥ÄÈåÑ' : 'Êü•Ë©¢'}
                                            </span>
                                        </div>
                                        {searchResult.address && <p className="text-sm text-gray-400 mb-2">üìç {searchResult.address}</p>}
                                        {searchResult.status && <p className="text-sm text-gray-400 mb-2">üìä {searchResult.status}</p>}
                                        {searchResult.capital && <p className="text-sm text-gray-400 mb-2">üí∞ {searchResult.capital}</p>}
                                        {searchResult.note && <p className="text-sm text-gray-400 mb-2">üìù {searchResult.note}</p>}
                                        
                                        {searchResult.source === 'api' && (
                                            <button
                                                onClick={(e) => { e.stopPropagation(); handleSaveFromSearch(); }}
                                                className="w-full mt-4 py-4 primary-button text-white rounded-2xl font-semibold flex items-center justify-center gap-2"
                                            >
                                                <Save />
                                                ÂÑ≤Â≠òÂà∞Ë®òÈåÑ
                                            </button>
                                        )}
                                    </div>
                                )}

                                {/* Êï∏Â≠óÈçµÁõ§ */}
                                <div className="glass-card rounded-3xl p-4">
                                    <div className="grid grid-cols-3 gap-3 mb-3">
                                        {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(num => (
                                            <button
                                                key={num}
                                                onClick={() => handleNumberClick(num.toString())}
                                                className="aspect-square glass-button rounded-2xl text-2xl font-bold hover:scale-95 active:scale-90 transition-all"
                                            >
                                                {num}
                                            </button>
                                        ))}
                                    </div>
                                    <div className="grid grid-cols-3 gap-3">
                                        <button
                                            // Ê†πÊìöÁãÄÊÖãÂàáÊèõÂäüËÉΩ (Backspace / Clear All)
                                            onClick={isSearchResultPresent ? handleClearAll : handleBackspace}
                                            className={`aspect-square glass-button rounded-2xl flex items-center justify-center hover:scale-95 active:scale-90 transition-all ${isSearchResultPresent ? 'text-blue-400' : 'text-red-400'}`}
                                        >
                                            {isSearchResultPresent ? <ClearAll /> : <Delete />}
                                        </button>
                                        <button
                                            onClick={() => handleNumberClick('0')}
                                            className="aspect-square glass-button rounded-2xl text-2xl font-bold hover:scale-95 active:scale-90 transition-all"
                                        >
                                            0
                                        </button>
                                        <button
                                            onClick={handleSearch}
                                            disabled={isSearching || searchTaxId.length !== 8}
                                            className="aspect-square primary-button rounded-2xl flex items-center justify-center disabled:opacity-30 hover:scale-95 active:scale-90 transition-all"
                                        >
                                            {isSearching ? <RefreshCw /> : <Search />}
                                        </button>
                                    </div>
                                </div>

                                {/* Ë≥áÊñô‰æÜÊ∫êË≤ºÈΩäÈçµÁõ§ */}
                                <div className="p-2 text-center text-xs text-gray-500">
                                    <p>Ë≥áÊñô‰æÜÊ∫êÔºög0v Áµ±Á∑®Êü•Ë©¢ API</p>
                                    <p className="mt-1">Ë≥áÊñôÂÑ≤Â≠òÊñºÁÄèË¶ΩÂô®Êú¨Âú∞</p>
                                </div>
                            </div>
                        )}

                        {/* Ê≠∑Âè≤Ë®òÈåÑÈ†ÅÁ±§ */}
                        {activeTab === 'history' && (
                            // Content ÂÆπÂô®‰ΩøÁî® space-y-4 ‰æÜÁµ±‰∏ÄÈñìË∑ù
                            <div className="space-y-4">
                                {/* 1. Êìç‰ΩúÊåâÈàï (Êñ∞Â¢û/ÂåØÂá∫/ÂåØÂÖ•) */}
                                <div className="grid grid-cols-3 gap-3">
                                    <button
                                        onClick={() => setIsAdding(true)}
                                        className="glass-button rounded-2xl py-4 font-medium flex flex-col items-center justify-center gap-2 hover:scale-95 active:scale-90 transition-all"
                                    >
                                        <Plus />
                                        <span className="text-xs">Êñ∞Â¢û</span>
                                    </button>
                                    <button
                                        onClick={exportData}
                                        disabled={records.length === 0}
                                        className="glass-button rounded-2xl py-4 font-medium flex flex-col items-center justify-center gap-2 hover:scale-95 active:scale-90 transition-all disabled:opacity-30"
                                    >
                                        <Download />
                                        <span className="text-xs">ÂåØÂá∫</span>
                                    </button>
                                    <label className="glass-button rounded-2xl py-4 font-medium flex flex-col items-center justify-center gap-2 hover:scale-95 active:scale-90 transition-all cursor-pointer">
                                        <Upload />
                                        <span className="text-xs">ÂåØÂÖ•</span>
                                        <input type="file" accept=".json" onChange={importData} className="hidden" />
                                    </label>
                                </div>

                                {/* 2. ÊêúÂ∞ãÊ°Ü - ÂØ¶ÁèæÁΩÆÈ†ÇÂõ∫ÂÆö (Sticky) UI/ÈñìË∑ù‰øÆÊ≠£ */}
                                {/* üåü ‰øÆÊ≠£Èªû: ÁßªÈô§ pt-4/pb-4ÔºåËÆì space-y-4 ÊéßÂà∂ÂûÇÁõ¥ÈñìË∑ù„ÄÇËÉåÊôØ‰ΩøÁî® bg-black Á¢∫‰øùÁΩÆÈ†ÇÂπ≥È†Ü„ÄÇ */}
                                <div className="sticky top-0 z-10 -mx-4 px-4 bg-black border-b border-gray-800 shadow-xl"> 
                                    <div className="relative flex items-center py-4">
                                        <Search className="w-5 h-5 absolute left-6 text-gray-400 pointer-events-none" />
                                        <input
                                            type="text"
                                            value={historySearchText}
                                            onChange={(e) => setHistorySearchText(e.target.value)}
                                            placeholder="ÊêúÂ∞ãÁµ±Á∑®ÊàñÂÖ¨Âè∏ÂêçÁ®±"
                                            className="w-full pl-14 pr-4 py-4 rounded-2xl outline-none focus:border focus:border-blue-500 bg-black/60 border border-gray-700 placeholder:text-gray-500"
                                        />
                                        {historySearchText && (
                                            <button
                                                onClick={() => setHistorySearchText('')}
                                                className="absolute right-7 text-gray-400 hover:text-white"
                                            >
                                                <X />
                                            </button>
                                        )}
                                    </div>
                                </div>

                                {/* 3. Êñ∞Â¢ûË°®ÂñÆ */}
                                {isAdding && (
                                    <div className="glass-card rounded-3xl p-6">
                                        <h2 className="text-xl font-bold mb-4">Êñ∞Â¢ûË®òÈåÑ</h2>
                                        <div className="space-y-4">
                                            <div>
                                                <label className="block text-gray-400 text-sm mb-2">Áµ±‰∏ÄÁ∑®Ëôü *</label>
                                                <input
                                                    type="text"
                                                    value={newRecord.taxId}
                                                    onChange={(e) => setNewRecord({ ...newRecord, taxId: e.target.value })}
                                                    placeholder="8‰ΩçÊï∏Â≠ó"
                                                    maxLength="8"
                                                    className="w-full px-4 py-3 bg-black/50 rounded-xl border border-gray-700 focus:border-blue-500 outline-none"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-gray-400 text-sm mb-2">ÂÖ¨Âè∏Êä¨È†≠ *</label>
                                                <input
                                                    type="text"
                                                    value={newRecord.companyName}
                                                    onChange={(e) => setNewRecord({ ...newRecord, companyName: e.target.value })}
                                                    placeholder="ÂÆåÊï¥ÂÖ¨Âè∏ÂêçÁ®±"
                                                    className="w-full px-4 py-3 bg-black/50 rounded-xl border border-gray-700 focus:border-blue-500 outline-none"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-gray-400 text-sm mb-2">ÂÇôË®ª</label>
                                                <textarea
                                                    value={newRecord.note}
                                                    onChange={(e) => setNewRecord({ ...newRecord, note: e.target.value })}
                                                    placeholder="ÈÅ∏Â°´"
                                                    rows={2}
                                                    className="w-full px-4 py-3 bg-black/50 rounded-xl border border-gray-700 focus:border-blue-500 outline-none"
                                                />
                                            </div>
                                            <div className="flex gap-3">
                                                <button
                                                    onClick={handleAddRecord}
                                                    className="flex-1 py-3 primary-button rounded-xl font-semibold"
                                                >
                                                    ÂÑ≤Â≠ò
                                                </button>
                                                <button
                                                    onClick={() => {
                                                        setIsAdding(false);
                                                        setNewRecord({ taxId: '', companyName: '', note: '' });
                                                    }}
                                                    className="flex-1 py-3 glass-button rounded-xl font-semibold"
                                                >
                                                    ÂèñÊ∂à
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                {/* 4. Ë®òÈåÑÂàóË°® */}
                                <div className="space-y-3">
                                    {loading ? (
                                        <div className="text-center py-8 text-gray-400">ËºâÂÖ•‰∏≠...</div>
                                    ) : filteredRecords.length === 0 ? (
                                        <div className="text-center py-8 text-gray-400">
                                            {historySearchText ? 'Êü•ÁÑ°Áõ∏ÈóúË®òÈåÑ' : 'Â∞öÁÑ°Ë®òÈåÑ'}
                                        </div>
                                    ) : (
                                        filteredRecords.map((record) => (
                                            <div 
                                                key={record.taxId} 
                                                className={`glass-card rounded-2xl p-4 ${editingId === record.taxId ? '' : 'cursor-pointer hover:bg-opacity-90 transition-all'}`}
                                                onClick={editingId === record.taxId ? null : () => openModal(record.taxId, record.companyName, record.note)}
                                            >
                                                {editingId === record.taxId ? (
                                                    <div className="space-y-3" onClick={(e) => e.stopPropagation()}>
                                                        <div>
                                                            <label className="block text-gray-400 text-sm mb-2">ÂÖ¨Âè∏Êä¨È†≠ *</label>
                                                            <input
                                                                type="text"
                                                                value={editForm.companyName}
                                                                onChange={(e) => setEditForm({ ...editForm, companyName: e.target.value })}
                                                                className="w-full px-3 py-2 bg-black/50 rounded-xl border border-gray-700 focus:border-blue-500 outline-none"
                                                            />
                                                        </div>
                                                        <div>
                                                            <label className="block text-gray-400 text-sm mb-2">ÂÇôË®ª</label>
                                                            <textarea
                                                                value={editForm.note || ''}
                                                                onChange={(e) => setEditForm({ ...editForm, note: e.target.value })}
                                                                rows={2}
                                                                className="w-full px-3 py-2 bg-black/50 rounded-xl border border-gray-700 focus:border-blue-500 outline-none"
                                                            />
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <button
                                                                onClick={handleUpdateRecord}
                                                                className="flex-1 py-2 primary-button rounded-xl font-semibold flex items-center justify-center gap-2"
                                                            >
                                                                <Save />
                                                                ÂÑ≤Â≠ò
                                                            </button>
                                                            <button
                                                                onClick={cancelEdit}
                                                                className="flex-1 py-2 glass-button rounded-xl font-semibold flex items-center justify-center gap-2"
                                                            >
                                                                <X />
                                                                ÂèñÊ∂à
                                                            </button>
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div>
                                                        <div className="flex items-start justify-between mb-2">
                                                            <div className="flex-1">
                                                                <h3 className="text-lg font-bold mb-1">{record.companyName}</h3>
                                                                <p className="text-blue-400 text-sm">{record.taxId}</p>
                                                            </div>
                                                            <div className="flex gap-2 ml-2" onClick={(e) => e.stopPropagation()}>
                                                                <button
                                                                    onClick={() => startEdit(record)}
                                                                    className="p-2 glass-button rounded-lg text-blue-400 hover:scale-95 transition-all"
                                                                >
                                                                    <Edit2 />
                                                                </button>
                                                                <button
                                                                    onClick={() => deleteRecord(record.taxId)}
                                                                    className="p-2 glass-button rounded-lg text-red-400 hover:scale-95 transition-all"
                                                                >
                                                                    <Trash2 />
                                                                </button>
                                                            </div>
                                                        </div>
                                                        {record.address && <p className="text-sm text-gray-400 mb-1">üìç {record.address}</p>}
                                                        {record.note && <p className="text-sm text-gray-400">üìù {record.note}</p>}
                                                    </div>
                                                )}
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        )}
                    </div>
                    
                    {/* Back to Top Button */}
                    {showBackToTop && (
                        <button
                            onClick={scrollToTop}
                            className="fixed bottom-24 right-6 p-4 primary-button rounded-full shadow-lg transition-all duration-300 z-50 hover:scale-105"
                        >
                            <ArrowUp />
                        </button>
                    )}
                </div>
            );
        }

        ReactDOM.render(<TaxIdManager />, document.getElementById('root'));
    </script>
</body>
</html>